#!/usr/bin/env bash
set -eu -o pipefail

readonly repo_dir="$( cd -- $(dirname $(readlink -f ${BASH_SOURCE}))/..; pwd )"

cd "${repo_dir}"

bin/generate-source

if [ "${WMD_DOC_OPEN_FORCE-true}" = "true" ]; then
    OPEN_ARG="--open"
else
    OPEN_ARG=""
fi

# Use `--release` so we re-use artifacts from standard builds

cargo doc \
          --workspace \
          --package capnp \
          --document-private-items \
          --no-deps \
          --locked \
          --release \
          ${OPEN_ARG}
